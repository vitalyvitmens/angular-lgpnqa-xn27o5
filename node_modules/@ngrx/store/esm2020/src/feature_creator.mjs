import { capitalize } from './helpers';
import { isPlainObject } from './meta-reducers/utils';
import { createFeatureSelector, createSelector, } from './selector';
/**
 * @description
 * A function that accepts a feature name and a feature reducer, and creates
 * a feature selector and a selector for each feature state property.
 * This function also provides the ability to add extra selectors to
 * the feature object.
 *
 * @param featureConfig An object that contains a feature name and a feature
 * reducer as required, and extra selectors factory as an optional argument.
 * @returns An object that contains a feature name, a feature reducer,
 * a feature selector, a selector for each feature state property, and extra
 * selectors.
 *
 * @usageNotes
 *
 * ```ts
 * interface ProductsState {
 *   products: Product[];
 *   selectedId: string | null;
 * }
 *
 * const initialState: ProductsState = {
 *   products: [],
 *   selectedId: null,
 * };
 *
 * const productsFeature = createFeature({
 *   name: 'products',
 *   reducer: createReducer(
 *     initialState,
 *     on(ProductsApiActions.loadSuccess(state, { products }) => ({
 *       ...state,
 *       products,
 *     }),
 *   ),
 * });
 *
 * const {
 *   name,
 *   reducer,
 *   // feature selector
 *   selectProductsState, // type: MemoizedSelector<Record<string, any>, ProductsState>
 *   // feature state properties selectors
 *   selectProducts, // type: MemoizedSelector<Record<string, any>, Product[]>
 *   selectSelectedId, // type: MemoizedSelector<Record<string, any>, string | null>
 * } = productsFeature;
 * ```
 *
 * **Creating Feature with Extra Selectors**
 *
 * ```ts
 * type CallState = 'init' | 'loading' | 'loaded' | { error: string };
 *
 * interface State extends EntityState<Product> {
 *   callState: CallState;
 * }
 *
 * const adapter = createEntityAdapter<Product>();
 * const initialState: State = adapter.getInitialState({
 *   callState: 'init',
 * });
 *
 * export const productsFeature = createFeature({
 *   name: 'products',
 *   reducer: createReducer(initialState),
 *   extraSelectors: ({ selectProductsState, selectCallState }) => ({
 *     ...adapter.getSelectors(selectBooksState),
 *     ...getCallStateSelectors(selectCallState)
 *   }),
 * });
 *
 * const {
 *   name,
 *   reducer,
 *   // feature selector
 *   selectProductsState,
 *   // feature state properties selectors
 *   selectIds,
 *   selectEntities,
 *   selectCallState,
 *   // selectors returned by `adapter.getSelectors`
 *   selectAll,
 *   selectTotal,
 *   // selectors returned by `getCallStateSelectors`
 *   selectIsLoading,
 *   selectIsLoaded,
 *   selectError,
 * } = productsFeature;
 * ```
 */
export function createFeature(featureConfig) {
    const { name, reducer, extraSelectors: extraSelectorsFactory, } = featureConfig;
    const featureSelector = createFeatureSelector(name);
    const nestedSelectors = createNestedSelectors(featureSelector, reducer);
    const baseSelectors = {
        [`select${capitalize(name)}State`]: featureSelector,
        ...nestedSelectors,
    };
    const extraSelectors = extraSelectorsFactory
        ? extraSelectorsFactory(baseSelectors)
        : {};
    return {
        name,
        reducer,
        ...baseSelectors,
        ...extraSelectors,
    };
}
function createNestedSelectors(featureSelector, reducer) {
    const initialState = getInitialState(reducer);
    const nestedKeys = (isPlainObject(initialState) ? Object.keys(initialState) : []);
    return nestedKeys.reduce((nestedSelectors, nestedKey) => ({
        ...nestedSelectors,
        [`select${capitalize(nestedKey)}`]: createSelector(featureSelector, (parentState) => parentState?.[nestedKey]),
    }), {});
}
function getInitialState(reducer) {
    return reducer(undefined, { type: '@ngrx/feature/init' });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZV9jcmVhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbW9kdWxlcy9zdG9yZS9zcmMvZmVhdHVyZV9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFdkMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsY0FBYyxHQUVmLE1BQU0sWUFBWSxDQUFDO0FBa0dwQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5Rkc7QUFDSCxNQUFNLFVBQVUsYUFBYSxDQU0zQixhQU1DO0lBRUQsTUFBTSxFQUNKLElBQUksRUFDSixPQUFPLEVBQ1AsY0FBYyxFQUFFLHFCQUFxQixHQUN0QyxHQUFHLGFBQWEsQ0FBQztJQUVsQixNQUFNLGVBQWUsR0FBRyxxQkFBcUIsQ0FBZSxJQUFJLENBQUMsQ0FBQztJQUNsRSxNQUFNLGVBQWUsR0FBRyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEUsTUFBTSxhQUFhLEdBQUc7UUFDcEIsQ0FBQyxTQUFTLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsZUFBZTtRQUNuRCxHQUFHLGVBQWU7S0FDOEMsQ0FBQztJQUNuRSxNQUFNLGNBQWMsR0FBRyxxQkFBcUI7UUFDMUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQztRQUN0QyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBRVAsT0FBTztRQUNMLElBQUk7UUFDSixPQUFPO1FBQ1AsR0FBRyxhQUFhO1FBQ2hCLEdBQUcsY0FBYztLQUMrQyxDQUFDO0FBQ3JFLENBQUM7QUFFRCxTQUFTLHFCQUFxQixDQUk1QixlQUF5RCxFQUN6RCxPQUFvQztJQUVwQyxNQUFNLFlBQVksR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUMsTUFBTSxVQUFVLEdBQUcsQ0FDakIsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQ3ZCLENBQUM7SUFFeEMsT0FBTyxVQUFVLENBQUMsTUFBTSxDQUN0QixDQUFDLGVBQWUsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDL0IsR0FBRyxlQUFlO1FBQ2xCLENBQUMsU0FBUyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLGNBQWMsQ0FDaEQsZUFBZSxFQUNmLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FDMUM7S0FDRixDQUFDLEVBQ0YsRUFBNkMsQ0FDOUMsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FDdEIsT0FBb0M7SUFFcEMsT0FBTyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztBQUM1RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2FwaXRhbGl6ZSB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyBBY3Rpb25SZWR1Y2VyLCBTZWxlY3RvciB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGlzUGxhaW5PYmplY3QgfSBmcm9tICcuL21ldGEtcmVkdWNlcnMvdXRpbHMnO1xuaW1wb3J0IHtcbiAgY3JlYXRlRmVhdHVyZVNlbGVjdG9yLFxuICBjcmVhdGVTZWxlY3RvcixcbiAgTWVtb2l6ZWRTZWxlY3Rvcixcbn0gZnJvbSAnLi9zZWxlY3Rvcic7XG5pbXBvcnQgeyBGZWF0dXJlU2VsZWN0b3IsIE5lc3RlZFNlbGVjdG9ycyB9IGZyb20gJy4vZmVhdHVyZV9jcmVhdG9yX21vZGVscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZywgRmVhdHVyZVN0YXRlPiB7XG4gIG5hbWU6IEZlYXR1cmVOYW1lO1xuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPEZlYXR1cmVTdGF0ZT47XG59XG5cbnR5cGUgRmVhdHVyZTxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIGtleW9mIEFwcFN0YXRlICYgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBBcHBTdGF0ZVtGZWF0dXJlTmFtZV1cbj4gPSBGZWF0dXJlQ29uZmlnPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICZcbiAgQmFzZVNlbGVjdG9yczxBcHBTdGF0ZSwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT47XG5cbnR5cGUgRmVhdHVyZVdpdGhFeHRyYVNlbGVjdG9yczxcbiAgRmVhdHVyZU5hbWUgZXh0ZW5kcyBzdHJpbmcsXG4gIEZlYXR1cmVTdGF0ZSxcbiAgRXh0cmFTZWxlY3RvcnMgZXh0ZW5kcyBTZWxlY3RvcnNEaWN0aW9uYXJ5XG4+ID0gc3RyaW5nIGV4dGVuZHMga2V5b2YgRXh0cmFTZWxlY3RvcnNcbiAgPyBGZWF0dXJlPFJlY29yZDxzdHJpbmcsIGFueT4sIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+XG4gIDogT21pdDxcbiAgICAgIEZlYXR1cmU8UmVjb3JkPHN0cmluZywgYW55PiwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4sXG4gICAgICBrZXlvZiBFeHRyYVNlbGVjdG9yc1xuICAgID4gJlxuICAgICAgRXh0cmFTZWxlY3RvcnM7XG5cbnR5cGUgQmFzZVNlbGVjdG9yczxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIGtleW9mIEFwcFN0YXRlICYgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBBcHBTdGF0ZVtGZWF0dXJlTmFtZV1cbj4gPSBGZWF0dXJlU2VsZWN0b3I8QXBwU3RhdGUsIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICZcbiAgTmVzdGVkU2VsZWN0b3JzPEFwcFN0YXRlLCBGZWF0dXJlU3RhdGU+O1xuXG50eXBlIFNlbGVjdG9yc0RpY3Rpb25hcnkgPSBSZWNvcmQ8XG4gIHN0cmluZyxcbiAgU2VsZWN0b3I8UmVjb3JkPHN0cmluZywgYW55PiwgdW5rbm93bj5cbj47XG5cbnR5cGUgRXh0cmFTZWxlY3RvcnNGYWN0b3J5PFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZyxcbiAgRmVhdHVyZVN0YXRlLFxuICBFeHRyYVNlbGVjdG9ycyBleHRlbmRzIFNlbGVjdG9yc0RpY3Rpb25hcnlcbj4gPSAoXG4gIGJhc2VTZWxlY3RvcnM6IEJhc2VTZWxlY3RvcnM8UmVjb3JkPHN0cmluZywgYW55PiwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT5cbikgPT4gRXh0cmFTZWxlY3RvcnM7XG5cbnR5cGUgTm90QWxsb3dlZEZlYXR1cmVTdGF0ZUNoZWNrPEZlYXR1cmVTdGF0ZT4gPVxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBSZXF1aXJlZDxGZWF0dXJlU3RhdGU+XG4gICAgPyB1bmtub3duXG4gICAgOiAnb3B0aW9uYWwgcHJvcGVydGllcyBhcmUgbm90IGFsbG93ZWQgaW4gdGhlIGZlYXR1cmUgc3RhdGUnO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBmZWF0dXJlIG9iamVjdCB3aXRoIGV4dHJhIHNlbGVjdG9ycy5cbiAqXG4gKiBAcGFyYW0gZmVhdHVyZUNvbmZpZyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSwgYSBmZWF0dXJlXG4gKiByZWR1Y2VyLCBhbmQgZXh0cmEgc2VsZWN0b3JzIGZhY3RvcnkuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSwgYSBmZWF0dXJlIHJlZHVjZXIsXG4gKiBhIGZlYXR1cmUgc2VsZWN0b3IsIGEgc2VsZWN0b3IgZm9yIGVhY2ggZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0eSwgYW5kXG4gKiBleHRyYSBzZWxlY3RvcnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGZWF0dXJlPFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZyxcbiAgRmVhdHVyZVN0YXRlLFxuICBFeHRyYVNlbGVjdG9ycyBleHRlbmRzIFNlbGVjdG9yc0RpY3Rpb25hcnlcbj4oXG4gIGZlYXR1cmVDb25maWc6IEZlYXR1cmVDb25maWc8RmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4gJiB7XG4gICAgZXh0cmFTZWxlY3RvcnM6IEV4dHJhU2VsZWN0b3JzRmFjdG9yeTxcbiAgICAgIEZlYXR1cmVOYW1lLFxuICAgICAgRmVhdHVyZVN0YXRlLFxuICAgICAgRXh0cmFTZWxlY3RvcnNcbiAgICA+O1xuICB9ICYgTm90QWxsb3dlZEZlYXR1cmVTdGF0ZUNoZWNrPEZlYXR1cmVTdGF0ZT5cbik6IEZlYXR1cmVXaXRoRXh0cmFTZWxlY3RvcnM8RmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZSwgRXh0cmFTZWxlY3RvcnM+O1xuLyoqXG4gKiBDcmVhdGVzIGEgZmVhdHVyZSBvYmplY3QuXG4gKlxuICogQHBhcmFtIGZlYXR1cmVDb25maWcgQW4gb2JqZWN0IHRoYXQgY29udGFpbnMgYSBmZWF0dXJlIG5hbWUgYW5kIGEgZmVhdHVyZVxuICogcmVkdWNlci5cbiAqIEByZXR1cm5zIEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGEgZmVhdHVyZSBuYW1lLCBhIGZlYXR1cmUgcmVkdWNlcixcbiAqIGEgZmVhdHVyZSBzZWxlY3RvciwgYW5kIGEgc2VsZWN0b3IgZm9yIGVhY2ggZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0eS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZlYXR1cmU8RmVhdHVyZU5hbWUgZXh0ZW5kcyBzdHJpbmcsIEZlYXR1cmVTdGF0ZT4oXG4gIGZlYXR1cmVDb25maWc6IEZlYXR1cmVDb25maWc8RmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4gJlxuICAgIE5vdEFsbG93ZWRGZWF0dXJlU3RhdGVDaGVjazxGZWF0dXJlU3RhdGU+XG4pOiBGZWF0dXJlPFJlY29yZDxzdHJpbmcsIGFueT4sIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+O1xuLyoqXG4gKiBAZGVwcmVjYXRlZCBVc2UgdGhlIGBjcmVhdGVGZWF0dXJlYCBzaWduYXR1cmUgd2l0aG91dCByb290IHN0YXRlIGluc3RlYWQuXG4gKiBGb3IgbW9yZSBpbmZvIHNlZTogaHR0cHM6Ly9naXRodWIuY29tL25ncngvcGxhdGZvcm0vaXNzdWVzLzM3MzdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZlYXR1cmU8XG4gIEFwcFN0YXRlIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PixcbiAgRmVhdHVyZU5hbWUgZXh0ZW5kcyBrZXlvZiBBcHBTdGF0ZSAmIHN0cmluZyA9IGtleW9mIEFwcFN0YXRlICYgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBBcHBTdGF0ZVtGZWF0dXJlTmFtZV0gPSBBcHBTdGF0ZVtGZWF0dXJlTmFtZV1cbj4oXG4gIGZlYXR1cmVDb25maWc6IEZlYXR1cmVDb25maWc8RmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4gJlxuICAgIE5vdEFsbG93ZWRGZWF0dXJlU3RhdGVDaGVjazxGZWF0dXJlU3RhdGU+XG4pOiBGZWF0dXJlPEFwcFN0YXRlLCBGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPjtcbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBhIGZlYXR1cmUgbmFtZSBhbmQgYSBmZWF0dXJlIHJlZHVjZXIsIGFuZCBjcmVhdGVzXG4gKiBhIGZlYXR1cmUgc2VsZWN0b3IgYW5kIGEgc2VsZWN0b3IgZm9yIGVhY2ggZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0eS5cbiAqIFRoaXMgZnVuY3Rpb24gYWxzbyBwcm92aWRlcyB0aGUgYWJpbGl0eSB0byBhZGQgZXh0cmEgc2VsZWN0b3JzIHRvXG4gKiB0aGUgZmVhdHVyZSBvYmplY3QuXG4gKlxuICogQHBhcmFtIGZlYXR1cmVDb25maWcgQW4gb2JqZWN0IHRoYXQgY29udGFpbnMgYSBmZWF0dXJlIG5hbWUgYW5kIGEgZmVhdHVyZVxuICogcmVkdWNlciBhcyByZXF1aXJlZCwgYW5kIGV4dHJhIHNlbGVjdG9ycyBmYWN0b3J5IGFzIGFuIG9wdGlvbmFsIGFyZ3VtZW50LlxuICogQHJldHVybnMgQW4gb2JqZWN0IHRoYXQgY29udGFpbnMgYSBmZWF0dXJlIG5hbWUsIGEgZmVhdHVyZSByZWR1Y2VyLFxuICogYSBmZWF0dXJlIHNlbGVjdG9yLCBhIHNlbGVjdG9yIGZvciBlYWNoIGZlYXR1cmUgc3RhdGUgcHJvcGVydHksIGFuZCBleHRyYVxuICogc2VsZWN0b3JzLlxuICpcbiAqIEB1c2FnZU5vdGVzXG4gKlxuICogYGBgdHNcbiAqIGludGVyZmFjZSBQcm9kdWN0c1N0YXRlIHtcbiAqICAgcHJvZHVjdHM6IFByb2R1Y3RbXTtcbiAqICAgc2VsZWN0ZWRJZDogc3RyaW5nIHwgbnVsbDtcbiAqIH1cbiAqXG4gKiBjb25zdCBpbml0aWFsU3RhdGU6IFByb2R1Y3RzU3RhdGUgPSB7XG4gKiAgIHByb2R1Y3RzOiBbXSxcbiAqICAgc2VsZWN0ZWRJZDogbnVsbCxcbiAqIH07XG4gKlxuICogY29uc3QgcHJvZHVjdHNGZWF0dXJlID0gY3JlYXRlRmVhdHVyZSh7XG4gKiAgIG5hbWU6ICdwcm9kdWN0cycsXG4gKiAgIHJlZHVjZXI6IGNyZWF0ZVJlZHVjZXIoXG4gKiAgICAgaW5pdGlhbFN0YXRlLFxuICogICAgIG9uKFByb2R1Y3RzQXBpQWN0aW9ucy5sb2FkU3VjY2VzcyhzdGF0ZSwgeyBwcm9kdWN0cyB9KSA9PiAoe1xuICogICAgICAgLi4uc3RhdGUsXG4gKiAgICAgICBwcm9kdWN0cyxcbiAqICAgICB9KSxcbiAqICAgKSxcbiAqIH0pO1xuICpcbiAqIGNvbnN0IHtcbiAqICAgbmFtZSxcbiAqICAgcmVkdWNlcixcbiAqICAgLy8gZmVhdHVyZSBzZWxlY3RvclxuICogICBzZWxlY3RQcm9kdWN0c1N0YXRlLCAvLyB0eXBlOiBNZW1vaXplZFNlbGVjdG9yPFJlY29yZDxzdHJpbmcsIGFueT4sIFByb2R1Y3RzU3RhdGU+XG4gKiAgIC8vIGZlYXR1cmUgc3RhdGUgcHJvcGVydGllcyBzZWxlY3RvcnNcbiAqICAgc2VsZWN0UHJvZHVjdHMsIC8vIHR5cGU6IE1lbW9pemVkU2VsZWN0b3I8UmVjb3JkPHN0cmluZywgYW55PiwgUHJvZHVjdFtdPlxuICogICBzZWxlY3RTZWxlY3RlZElkLCAvLyB0eXBlOiBNZW1vaXplZFNlbGVjdG9yPFJlY29yZDxzdHJpbmcsIGFueT4sIHN0cmluZyB8IG51bGw+XG4gKiB9ID0gcHJvZHVjdHNGZWF0dXJlO1xuICogYGBgXG4gKlxuICogKipDcmVhdGluZyBGZWF0dXJlIHdpdGggRXh0cmEgU2VsZWN0b3JzKipcbiAqXG4gKiBgYGB0c1xuICogdHlwZSBDYWxsU3RhdGUgPSAnaW5pdCcgfCAnbG9hZGluZycgfCAnbG9hZGVkJyB8IHsgZXJyb3I6IHN0cmluZyB9O1xuICpcbiAqIGludGVyZmFjZSBTdGF0ZSBleHRlbmRzIEVudGl0eVN0YXRlPFByb2R1Y3Q+IHtcbiAqICAgY2FsbFN0YXRlOiBDYWxsU3RhdGU7XG4gKiB9XG4gKlxuICogY29uc3QgYWRhcHRlciA9IGNyZWF0ZUVudGl0eUFkYXB0ZXI8UHJvZHVjdD4oKTtcbiAqIGNvbnN0IGluaXRpYWxTdGF0ZTogU3RhdGUgPSBhZGFwdGVyLmdldEluaXRpYWxTdGF0ZSh7XG4gKiAgIGNhbGxTdGF0ZTogJ2luaXQnLFxuICogfSk7XG4gKlxuICogZXhwb3J0IGNvbnN0IHByb2R1Y3RzRmVhdHVyZSA9IGNyZWF0ZUZlYXR1cmUoe1xuICogICBuYW1lOiAncHJvZHVjdHMnLFxuICogICByZWR1Y2VyOiBjcmVhdGVSZWR1Y2VyKGluaXRpYWxTdGF0ZSksXG4gKiAgIGV4dHJhU2VsZWN0b3JzOiAoeyBzZWxlY3RQcm9kdWN0c1N0YXRlLCBzZWxlY3RDYWxsU3RhdGUgfSkgPT4gKHtcbiAqICAgICAuLi5hZGFwdGVyLmdldFNlbGVjdG9ycyhzZWxlY3RCb29rc1N0YXRlKSxcbiAqICAgICAuLi5nZXRDYWxsU3RhdGVTZWxlY3RvcnMoc2VsZWN0Q2FsbFN0YXRlKVxuICogICB9KSxcbiAqIH0pO1xuICpcbiAqIGNvbnN0IHtcbiAqICAgbmFtZSxcbiAqICAgcmVkdWNlcixcbiAqICAgLy8gZmVhdHVyZSBzZWxlY3RvclxuICogICBzZWxlY3RQcm9kdWN0c1N0YXRlLFxuICogICAvLyBmZWF0dXJlIHN0YXRlIHByb3BlcnRpZXMgc2VsZWN0b3JzXG4gKiAgIHNlbGVjdElkcyxcbiAqICAgc2VsZWN0RW50aXRpZXMsXG4gKiAgIHNlbGVjdENhbGxTdGF0ZSxcbiAqICAgLy8gc2VsZWN0b3JzIHJldHVybmVkIGJ5IGBhZGFwdGVyLmdldFNlbGVjdG9yc2BcbiAqICAgc2VsZWN0QWxsLFxuICogICBzZWxlY3RUb3RhbCxcbiAqICAgLy8gc2VsZWN0b3JzIHJldHVybmVkIGJ5IGBnZXRDYWxsU3RhdGVTZWxlY3RvcnNgXG4gKiAgIHNlbGVjdElzTG9hZGluZyxcbiAqICAgc2VsZWN0SXNMb2FkZWQsXG4gKiAgIHNlbGVjdEVycm9yLFxuICogfSA9IHByb2R1Y3RzRmVhdHVyZTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRmVhdHVyZTxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIGtleW9mIEFwcFN0YXRlICYgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBBcHBTdGF0ZVtGZWF0dXJlTmFtZV0sXG4gIEV4dHJhU2VsZWN0b3JzIGV4dGVuZHMgU2VsZWN0b3JzRGljdGlvbmFyeVxuPihcbiAgZmVhdHVyZUNvbmZpZzogRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmIHtcbiAgICBleHRyYVNlbGVjdG9ycz86IEV4dHJhU2VsZWN0b3JzRmFjdG9yeTxcbiAgICAgIEZlYXR1cmVOYW1lLFxuICAgICAgRmVhdHVyZVN0YXRlLFxuICAgICAgRXh0cmFTZWxlY3RvcnNcbiAgICA+O1xuICB9XG4pOiBGZWF0dXJlPEFwcFN0YXRlLCBGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmIEV4dHJhU2VsZWN0b3JzIHtcbiAgY29uc3Qge1xuICAgIG5hbWUsXG4gICAgcmVkdWNlcixcbiAgICBleHRyYVNlbGVjdG9yczogZXh0cmFTZWxlY3RvcnNGYWN0b3J5LFxuICB9ID0gZmVhdHVyZUNvbmZpZztcblxuICBjb25zdCBmZWF0dXJlU2VsZWN0b3IgPSBjcmVhdGVGZWF0dXJlU2VsZWN0b3I8RmVhdHVyZVN0YXRlPihuYW1lKTtcbiAgY29uc3QgbmVzdGVkU2VsZWN0b3JzID0gY3JlYXRlTmVzdGVkU2VsZWN0b3JzKGZlYXR1cmVTZWxlY3RvciwgcmVkdWNlcik7XG4gIGNvbnN0IGJhc2VTZWxlY3RvcnMgPSB7XG4gICAgW2BzZWxlY3Qke2NhcGl0YWxpemUobmFtZSl9U3RhdGVgXTogZmVhdHVyZVNlbGVjdG9yLFxuICAgIC4uLm5lc3RlZFNlbGVjdG9ycyxcbiAgfSBhcyBCYXNlU2VsZWN0b3JzPFJlY29yZDxzdHJpbmcsIGFueT4sIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+O1xuICBjb25zdCBleHRyYVNlbGVjdG9ycyA9IGV4dHJhU2VsZWN0b3JzRmFjdG9yeVxuICAgID8gZXh0cmFTZWxlY3RvcnNGYWN0b3J5KGJhc2VTZWxlY3RvcnMpXG4gICAgOiB7fTtcblxuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgcmVkdWNlcixcbiAgICAuLi5iYXNlU2VsZWN0b3JzLFxuICAgIC4uLmV4dHJhU2VsZWN0b3JzLFxuICB9IGFzIEZlYXR1cmU8QXBwU3RhdGUsIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICYgRXh0cmFTZWxlY3RvcnM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU5lc3RlZFNlbGVjdG9yczxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlU3RhdGVcbj4oXG4gIGZlYXR1cmVTZWxlY3RvcjogTWVtb2l6ZWRTZWxlY3RvcjxBcHBTdGF0ZSwgRmVhdHVyZVN0YXRlPixcbiAgcmVkdWNlcjogQWN0aW9uUmVkdWNlcjxGZWF0dXJlU3RhdGU+XG4pOiBOZXN0ZWRTZWxlY3RvcnM8QXBwU3RhdGUsIEZlYXR1cmVTdGF0ZT4ge1xuICBjb25zdCBpbml0aWFsU3RhdGUgPSBnZXRJbml0aWFsU3RhdGUocmVkdWNlcik7XG4gIGNvbnN0IG5lc3RlZEtleXMgPSAoXG4gICAgaXNQbGFpbk9iamVjdChpbml0aWFsU3RhdGUpID8gT2JqZWN0LmtleXMoaW5pdGlhbFN0YXRlKSA6IFtdXG4gICkgYXMgQXJyYXk8a2V5b2YgRmVhdHVyZVN0YXRlICYgc3RyaW5nPjtcblxuICByZXR1cm4gbmVzdGVkS2V5cy5yZWR1Y2UoXG4gICAgKG5lc3RlZFNlbGVjdG9ycywgbmVzdGVkS2V5KSA9PiAoe1xuICAgICAgLi4ubmVzdGVkU2VsZWN0b3JzLFxuICAgICAgW2BzZWxlY3Qke2NhcGl0YWxpemUobmVzdGVkS2V5KX1gXTogY3JlYXRlU2VsZWN0b3IoXG4gICAgICAgIGZlYXR1cmVTZWxlY3RvcixcbiAgICAgICAgKHBhcmVudFN0YXRlKSA9PiBwYXJlbnRTdGF0ZT8uW25lc3RlZEtleV1cbiAgICAgICksXG4gICAgfSksXG4gICAge30gYXMgTmVzdGVkU2VsZWN0b3JzPEFwcFN0YXRlLCBGZWF0dXJlU3RhdGU+XG4gICk7XG59XG5cbmZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZTxGZWF0dXJlU3RhdGU+KFxuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPEZlYXR1cmVTdGF0ZT5cbik6IEZlYXR1cmVTdGF0ZSB7XG4gIHJldHVybiByZWR1Y2VyKHVuZGVmaW5lZCwgeyB0eXBlOiAnQG5ncngvZmVhdHVyZS9pbml0JyB9KTtcbn1cbiJdfQ==